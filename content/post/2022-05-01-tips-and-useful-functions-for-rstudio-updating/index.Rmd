---
title: 'Tips and useful functions for RStudio (Updating)'
author: Shiya Liu
date: "`r Sys.Date()`"
slug: tips-and-useful-functions-for-rstudio-updating
categories:
  - R
tags:
  - RStudio
draft: FALSE
---

```{r setup, include=FALSE}
  knitr::opts_chunk$set(eval = FALSE)
```

# Install and load R packages in bulk

```{r}
  #install.packages(pacman)
  library(pacman)
  pacman::p_load()
```

# Import data

## Import multiple excel files & sheets and merge

### By column

```{r}
  library(tidyverse)
  df <- list.files("path", pattern = "*.xlsx", full.names = T) %>%
    lapply(readxl::read_excel)%>%
    reduce(inner_join, by=c("a","b")) %>%
    arrange()
  View(df)
  colnames(df) <- c("a","b",
                str_replace(
                  list.files(
                    "path", pattern = "*.xlsx"),
                  ".xlsx",""))

```

### By row

-   For multiple excel files

```{r}
  files <- list.files("path", pattern = "*.xlsx", full.names = T)
  df1 <- map_dfr(files, readxl::read_excel)
  View(df1)
```

-   For multiple sheets

```{r}
  path <- ".xlsx"
  df <- map_dfr(excel_sheets(path),
              ~ read_xlsx(path, sheet = .x))
```

-   For files with different column names

    -   Multiple excel files

    ```{r}
      files <-  list.files("", pattern = ".xlsx", full.names = TRUE)
      df <- map(files, read_xlsx) %>%
        reduce(full_join, by = "")

    ```

    -   Multiple sheets

```{r}
 files <- "path.xlsx"
 df <- files %>%
   excel_sheets() %>%
   set_names() %>%
   map(read_excel,path = files)
```

# Export

## Export results directly

-   This command only exports tables generated by test1, does not include figures.

```{r}
  sink("test1.text")
  test1
  sink()
```

-   This commond helps to explore figures generated by test1.

```{r}
  pdf("test1.text") 
  test1
  sink() 
```

## Export tables using package

```{r}
  library(stargazer)
```

-   Export desciptive statistics tables\

```{r}
  stargazer(df, type = "html", out = "desriptive statisitcs table.doc", digits = 2,  
           title = "<em>Descriptive Statistics of Key Variables</em>",  
           align = T, no.space = T,  
           min.max = F, mean.sd = T, median = F, iqr = T, nobs = F,   
           omit.summary.stat = c("max","min"),  
           # omit.table.layout = c(),  
           # order = c(),  
           covariate.labels = c("x1","x2","x3"),  
          column.labels = c("Variables","Mean","SD","25th percentiles","75 Percentiles"),  
          summary.logical = F)
```

-   Export regression results tables

```{r}
  fit1 <- lm(y~x1+x2+x3)  
  fit2<- lm(y~x1+x2+x3+x2*x3)  
  stargazer(fit1,fit2, type = "html", 
            out = "Regression results.doc",digits = 3,  
            title = "<em>Regression Results</em>",  
            align = T, no.space = T,  
            dep.var.labels = c("y"),  
            covariate.labels = c("x1","x2","x3","x2*x3"),  
            omit.stat = c("f","adj.rsq"), notes.align ="l",  
            notes.append = FALSE,  
            notes = c(".p<.01;*p<.05;**p<.01;***p<.001"),  
            star.char = c( ".","*", "**", "***"),  
            star.cutoffs = c(.1, .05, .01, .001),  
            table.layout = "-d#-ctsa-n")
```

# Some fun stuff

-   Birthday cake

```{r}
  library(plotrix)  
  candle = function(pos)  
{  
    x=pos[1]  
    y=pos[2]  
    rect(x,y,x+.2,y+2,col="red")  
    polygon(c(x+.05,x-.1,x+.1,x+.3,x+.15,x+0.05), c(y+2,y+2.3,y+2.6,y+2.3,y+2,y+2),col="#EECF08")  
  
}
  plot(c(0,10), c(0,10),type="n", bty="n",xaxt="n",yaxt="n", main="Happy birthday", xlab="",ylab="")  
  draw.ellipse(5,2,col="dodgerblue2",a=4.4,b=1.7,border=1)  
  draw.ellipse(5,2,col="gold",a=4,b=1.4,border=1)  
  rect(1,2,9,5,col="gold",border="gold")  
  lines(c(1,1),c(2,5))  
  lines(c(9,9),c(2,5))  
  draw.ellipse(5,5,col="gold",a=4,b=1.4)  
  candle(c(2.5,4.5))  
  candle(c(3,5))  
  candle(c(4,4.5))  
  candle(c(5,5))  
  candle(c(6,4.5))  
  candle(c(7,5.2))  
  text(5,2.2,paste("Happy ",29,"th Birthday!!!",sep=''),cex=1.5,col="red") 
```

-   Happy face

```{r}
  library(ggChernoff)  
  face <- chernoffGrob(0.5,0.5,size=1e3,smile=2,brow=-1,colour='black',fill='yellow',nose=TRUE)  
  grid::grid.newpage()  
  grid::grid.draw(face)
```

# Recommend resources

-   ðŸ‘‰ [**Stargazer**](https://cran.r-project.org/web/packages/stargazer/stargazer.pdf)
